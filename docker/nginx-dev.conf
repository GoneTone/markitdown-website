# nginx-dev.conf — 開發環境 Nginx 設定
# 與正式版 nginx.conf 的差異：
#   - root 改為 /usr/share/nginx/html（Docker 容器內路徑）
#   - 移除 server_name（開發不需要）
#   - 移除快取設定（開發時不快取）
#   - 保留所有 COOP/COEP headers（Pyodide 必要）

server {
    listen 80;

    root /usr/share/nginx/html;
    index index.html;

    # ── 必要：SharedArrayBuffer 安全標頭 ──────────────────────────────────
    add_header Cross-Origin-Opener-Policy "same-origin" always;
    add_header Cross-Origin-Embedder-Policy "require-corp" always;

    # ── MIME Types ─────────────────────────────────────────────────────────
    # server 層級的 types{} 會覆蓋 http 層級的預設值，需完整列出所需類型
    types {
        text/html                             html htm;
        text/css                              css;
        application/javascript                js mjs;
        application/json                      json;
        application/wasm                      wasm;
        application/octet-stream              whl;
        image/svg+xml                         svg svgz;
        image/png                             png;
        image/jpeg                            jpg jpeg;
        image/gif                             gif;
        image/webp                            webp;
        image/x-icon                          ico;
        font/woff                             woff;
        font/woff2                            woff2;
        text/plain                            txt;
    }

    # pyodide/ 和 wheels/ 靜態資源加上 CORP header（browser-sync 代理需要）
    location ~* ^/(pyodide|wheels)/ {
        add_header Cross-Origin-Opener-Policy "same-origin" always;
        add_header Cross-Origin-Embedder-Policy "require-corp" always;
        add_header Cross-Origin-Resource-Policy "same-origin" always;
    }

    # 所有路由回到 index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    server_tokens off;
}
